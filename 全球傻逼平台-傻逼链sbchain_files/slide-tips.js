var Follow=function(options){var defaults={parent:"",trigger:"",panel:"",direction:"bottom",alignment:"left",event:"hover",duration:0,beforeShow:function(){},afterShow:function(){},beforeHide:function(){},afterHide:function(){}};this._options=$.extend({},defaults,options);if(typeof jQuery=="undefined"){console.warn("请引入jQuery,否则无法正常使用...");return}var parent=this.parent=this._options.parent,$parent=$(parent);if(!parent){if($(this._options.trigger).length!==1){console.log("参数：trigger 错误");return}if($(this._options.panel).length!==1){console.log("参数：panel 错误");return}}else{if($parent.length===1){this._options.trigger=".slide_tip_trigger";this._options.panel=".slide_tip_panel";this.$triggerArea=$parent.find(this._options.trigger);this.$panelArea=$parent.find(this._options.panel);$parent.css("position","relative")}else{console.log("请检查parent的书写是否有误")}}this.init()};Follow.prototype={constructor:Follow,init:function(){var durationToNum=Number(this._options.duration);this.$triggerArea=this.$triggerArea||$(this._options.trigger);this.$panelArea=this.$panelArea||$(this._options.panel);this.panelAlignment=this._options.alignment;this.panelDirection=this._options.direction;this.event=this._options.event;this.duration=!durationToNum&&durationToNum!=0?this._options.duration:durationToNum;this.beforeShow=this._options.beforeShow;this.afterShow=this._options.afterShow;this.beforeHide=this._options.beforeHide;this.afterHide=this._options.afterHide;this.controlFlag=false;this.timer=null;this.$triggerArea.attr("data-subordinate",this.parent+this._options.trigger);this.$panelArea.attr("data-subordinate",this.parent+this._options.trigger);this.bind()},bind:function(){var self=this;if(self.event=="hover"){self.$triggerArea.hover(function(e){clearTimeout(self.timer);self.timer=null;self.controlFlag=false;setTimeout(function(){self.unfolded()},200)},function(){self.timer=setTimeout(function(){self.controlFlag=true},200);$(document).on("mousemove",function(e){if(self.controlFlag){self.eventHandling(e)}})})}else{if(self.event=="click"){self.$triggerArea.click(function(e){self.panelDisplayControl()});$("html,body").on("click",function(e){self.eventHandling(e)});$(window).resize(function(){self.$panelArea.is(":hidden")?void (0):self.putAway()})}else{console.log("只接受click 和 hover 这两种方式。。。。")}}},panelDisplayControl:function(){this.$panelArea.is(":hidden")?this.unfolded():this.putAway()},putAway:function(){var self=this;this.beforeHide();if(self.duration===0){this.$panelArea.css("display","none");self.afterHide()}else{this.$panelArea.stop().slideUp(self.duration,function(){self.afterHide()})}},unfolded:function(){var self=this;this.beforeShow();this.setPosition();if(self.duration===0){this.$panelArea.css("display","block");self.afterShow()}else{this.$panelArea.stop().slideDown(self.duration,function(){self.afterShow()})}},setPosition:function(){if((this.panelAlignment=="ignore")||!this.panelAlignment||(this.panelDirection=="ignore")||!this.panelDirection){return}else{this.$panelArea.css({"position":"absolute"})}var triggerMargin=this.getMarginVal(this.$triggerArea);var triggerOffset=this.getOffset.call(this.$triggerArea[0]),triggerOffsetLeft=Boolean(this.parent)?parseFloat($(this.parent).css("paddingLeft"))+triggerMargin.marginLeft:triggerOffset.left,triggerOffsetTop=Boolean(this.parent)?parseFloat($(this.parent).css("paddingTop"))+triggerMargin.marginTop:triggerOffset.top;var triggerCompleteWidth=this.$triggerArea.outerWidth(),triggerCompleteHeight=this.$triggerArea.outerHeight(),panelCompleteWidth=this.$panelArea.outerWidth(true),panelCompleteHeight=this.$panelArea.outerHeight(true);if(this.panelDirection=="top"){switch(this.panelAlignment){case"left":this.$panelArea.css({left:triggerOffsetLeft,top:triggerOffsetTop-panelCompleteHeight});break;case"center":this.$panelArea.css({left:triggerOffsetLeft+triggerCompleteWidth/2-panelCompleteWidth/2,top:triggerOffsetTop-panelCompleteHeight});break;case"right":this.$panelArea.css({left:triggerOffsetLeft+triggerCompleteWidth-panelCompleteWidth,top:triggerOffsetTop-panelCompleteHeight});break;default:this.$panelArea.css({left:triggerOffsetLeft,top:triggerOffsetTop-panelCompleteHeight})}}else{if(this.panelDirection=="bottom"){switch(this.panelAlignment){case"left":this.$panelArea.css({left:triggerOffsetLeft,top:triggerOffsetTop+triggerCompleteHeight});break;case"center":this.$panelArea.css({left:triggerOffsetLeft+triggerCompleteWidth/2-panelCompleteWidth/2,top:triggerOffsetTop+triggerCompleteHeight});break;case"right":this.$panelArea.css({left:triggerOffsetLeft+triggerCompleteWidth-panelCompleteWidth,top:triggerOffsetTop+triggerCompleteHeight});break;default:this.$panelArea.css({left:triggerOffsetLeft,top:triggerOffsetTop+triggerCompleteHeight})}}else{if(this.panelDirection=="right"){switch(this.panelAlignment){case"top":this.$panelArea.css({left:triggerOffsetLeft+triggerCompleteWidth,top:triggerOffsetTop});break;case"center":this.$panelArea.css({left:triggerOffsetLeft+triggerCompleteWidth,top:triggerOffsetTop+triggerCompleteHeight/2-panelCompleteHeight/2});
    break;case"bottom":this.$panelArea.css({left:triggerOffsetLeft+triggerCompleteWidth,top:triggerOffsetTop+triggerCompleteHeight-panelCompleteHeight});break;default:this.$panelArea.css({left:triggerOffsetLeft+triggerCompleteWidth,top:triggerOffsetTop})}}else{if(this.panelDirection=="left"){switch(this.panelAlignment){case"top":this.$panelArea.css({left:triggerOffsetLeft-panelCompleteWidth,top:triggerOffsetTop});break;case"center":this.$panelArea.css({left:triggerOffsetLeft-panelCompleteWidth,top:triggerOffsetTop+triggerCompleteHeight/2-panelCompleteHeight/2});break;case"bottom":this.$panelArea.css({left:triggerOffsetLeft-panelCompleteWidth,top:triggerOffsetTop+triggerCompleteHeight-panelCompleteHeight});break;default:this.$panelArea.css({left:triggerOffsetLeft-panelCompleteWidth,top:triggerOffsetTop})}}}}}},getOffset:function(){var left=this.offsetLeft,top=this.offsetTop,par=this.offsetParent;while(par){left+=par.offsetLeft;top+=par.offsetTop;if(window.navigator.userAgent.indexOf("MSIE 8.0")<=-1){left+=par.clientLeft;top+=par.clientTop}par=par.offsetParent}return{left:left,top:top}},getMarginVal:function($ele){return{marginTop:parseFloat($ele.css("marginTop")),marginRight:parseFloat($ele.css("marginRight")),marginBottom:parseFloat($ele.css("marginBottom")),marginLeft:parseFloat($ele.css("marginLeft"))}},eventHandling:function(e){e=e||window.event;for(var eventSource=e.target||e.srcElement;eventSource;){if($(eventSource).attr("data-subordinate")&&$(eventSource).attr("data-subordinate").indexOf(this.parent+this._options.trigger)>-1){return}eventSource=eventSource.parentNode}this.controlFlag=false;this.$panelArea.is(":hidden")?void (0):this.putAway()}};